<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= category.name %> - TulipParty</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/aero.css">
</head>
<body>
  <header>
    <h1>TulipParty</h1>
    <div class="header-links">
      <a href="/" class="back-button">Home</a>
      <a href="/chat" class="create-button">Live Chat</a>
      <a href="/create" class="create-button">New Post</a>
    </div>
  </header>
  
  <div class="category-header">
    <h2><%= category.name %></h2>
    <p><%= category.description %></p>
    
    <div class="category-actions delete-control" style="display: none;">
      <% if (category.id !== 1) { %>
        <div class="delete-key-section">
          <input type="password" id="categoryDeleteKey" placeholder="Enter post key" required>
          <button onclick="deleteCategoryWithKey('<%= category.id %>')" class="delete-btn">Delete Category</button>
        </div>
      <% } %>
    </div>
  </div>

  <main class="posts-container">
    <% if (posts && posts.length > 0) { %>
      <% posts.forEach(post => { %>
        <article class="post">
          <div class="post-header">
            <div class="post-author">
              <a href="/profile/<%= post.username %>">
                <img src="<%= post.profile_pic ? '/' + post.profile_pic : '/uploads/default-avatar.png' %>" alt="<%= post.username %>" class="avatar">
              </a>
              <a href="/profile/<%= post.username %>" class="username"><%= post.username %></a>
            </div>
            <span class="date"><%= post.date %></span>
          </div>
          <h3><%= post.title %></h3>
          <div class="post-content"><%= post.content %></div>
          <% if (post.image_path) { %>
            <div class="post-image">
              <img src="<%= post.image_path %>" alt="Post image">
            </div>
          <% } %>
          <div class="post-actions delete-control" style="display: none;">
            <form action="/delete-post/<%= post.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this post?');">
              <input type="password" name="postKey" placeholder="Enter post key" required>
              <button type="submit" class="delete-btn">Delete Post</button>
            </form>
          </div>
        </article>
      <% }) %>
    <% } else { %>
      <p class="no-posts">No posts in this category yet. Be the first to post!</p>
    <% } %>
  </main>
  
  <footer>
    <p>&copy; <%= new Date().getFullYear() %> TulipParty - Argatha's chatting tool</p>
  </footer>
  <script src="/js/keySequence.js"></script>
  <script src="/js/formHandler.js"></script>
  <script src="/js/aeroEasterEgg.js"></script>
  <script src="/js/signupKeySequence.js"></script>
  <script>
    function deleteCategoryWithKey(categoryId) {
      const key = document.getElementById('categoryDeleteKey').value;
      if (!key) {
        alert('Please enter your post key');
        return;
      }
      
      if (confirm('Are you sure you want to delete this category? All posts will be moved to the Random category.')) {
        // Redirect to the simplified delete URL with the key as a query parameter
        window.location.href = `/delete-category/${categoryId}?key=${encodeURIComponent(key)}`;
      }
    }
  </script>
</body>
</html>
